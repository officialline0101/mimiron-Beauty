<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>アンケートフォーム</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --brand:#13ca5e;
      --text:#2b2b2b;
      --muted:#6c757d;
      --bg:#f7f7f7;
      --card:#fff;
      --danger:#dc3545;
    }
    *{box-sizing:border-box}
    body{
      font-family:"Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, sans-serif;
      background:var(--bg);
      margin:0;
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }
    .container{
      max-width:560px;
      margin:16px auto 32px;
      padding:20px;
      background:var(--card);
      border-radius:12px;
      box-shadow:0 6px 24px rgba(0,0,0,.06);
    }
    h1{
      margin:0 -20px 20px;
      padding:18px 20px;
      color:#fff;
      font-size:22px;
      font-weight:700;
      background:linear-gradient(135deg, var(--brand), #0fa958);
      border-radius:0 16px 0 40px;
    }
    .field{margin:14px 0 18px}
    .label{
      font-weight:600;
      margin-bottom:8px;
      display:flex; align-items:center; gap:8px;
    }
    .badge-required{
      display:inline-block; font-size:12px; line-height:1; padding:3px 6px; border-radius:6px;
      background:#ff3b30; color:#fff; font-weight:700;
    }
    .hint{color:var(--muted); font-size:12px; margin-top:6px}
    input[type="text"],input[type="tel"],input[type="date"],textarea{
      width:100%; padding:12px 14px; border:1px solid #d9d9d9; border-radius:8px; font-size:16px; background:#fff;
      transition:border .2s, box-shadow .2s;
    }
    textarea{min-height:84px; resize:vertical}
    input:focus, textarea:focus{outline:none; border-color:var(--brand); box-shadow:0 0 0 4px rgba(19,202,94,.12)}

    /* Toggle button group (単一選択) */
    .toggle{display:flex; flex-wrap:wrap; gap:10px}
    .toggle button{
      flex:1 1 calc(50% - 10px);
      padding:12px; background:#f3f4f6; border:1px solid #dcdfe4; border-radius:10px; cursor:pointer; font-size:15px;
      transition:transform .06s ease, background .2s, border-color .2s;
    }
    .toggle button:active{transform:scale(.98)}
    .toggle button.active{background:#1f2937; color:#fff; border-color:#1f2937}

    .detail-wrap{display:none; margin-top:10px}
    .detail-wrap.show{display:block}

    .submit{
      width:100%; margin-top:8px; padding:14px 16px; font-size:17px; font-weight:700; border:none; border-radius:10px;
      background:var(--danger); color:#fff; cursor:pointer; transition:filter .2s, transform .06s ease;
    }
    .submit:active{transform:translateY(1px)}

    .note{font-size:13px; color:#111; background:#eef9f5; padding:10px 12px; border:1px solid #d2efe5; border-radius:8px; margin-bottom:10px}
  </style>
</head>
<body>
  <div class="container">
    <h1>アンケートフォーム</h1>
    <p class="note">以下の必須項目をご入力の上、【送信】を押してください。</p>

    <!-- お名前 -->
    <div class="field">
      <div class="label">お名前 <span class="badge-required">必須</span></div>
      <input id="name" type="text" inputmode="text" placeholder="例）山田 太郎" autocomplete="name" />
    </div>

    <!-- 電話番号 -->
    <div class="field">
      <div class="label">電話番号 <span class="badge-required">必須</span></div>
      <input id="tel" type="tel" inputmode="numeric" pattern="[0-9]*" placeholder="ハイフンなし 例）09012345678" autocomplete="tel" />
      <div class="hint">※10〜11桁の数字をご入力ください</div>
    </div>

    <!-- 住所 -->
    <div class="field">
      <div class="label">住所 <span class="badge-required">必須</span></div>
      <input id="address" type="text" placeholder="例）東京都千代田区丸の内1-1-1" autocomplete="street-address" />
    </div>

    <!-- 生年月日 -->
    <div class="field">
      <div class="label">生年月日 <span class="badge-required">必須</span></div>
      <input id="birth" type="date" />
      <div class="hint">※端末によりカレンダー選択に対応していない場合があります。その際は直接入力してください（YYYY-MM-DD）。</div>
    </div>

    <!-- 性別 -->
    <div class="field">
      <div class="label">性別 <span class="badge-required">必須</span></div>
      <div class="toggle" role="group" aria-label="性別">
        <button type="button" data-group="gender" data-value="男性">男性</button>
        <button type="button" data-group="gender" data-value="女性">女性</button>
      </div>
    </div>

    <!-- 過去にエステサロンに通ったこと -->
    <div class="field">
      <div class="label">過去にエステサロンに通ったことがありますか <span class="badge-required">必須</span></div>
      <div class="toggle" role="group" aria-label="通院歴">
        <button type="button" data-group="visitedEsthe" data-value="有">有</button>
        <button type="button" data-group="visitedEsthe" data-value="無">無</button>
      </div>
    </div>

    <!-- アレルギーの有無 -->
    <div class="field">
      <div class="label">アレルギーの有無 <span class="badge-required">必須</span></div>
      <div class="toggle" role="group" aria-label="アレルギーの有無">
        <button type="button" data-group="allergy" data-value="有">有</button>
        <button type="button" data-group="allergy" data-value="無">無</button>
      </div>
      <div id="allergyDetailWrap" class="detail-wrap">
        <div class="label" style="margin-top:10px">有りの場合は詳細をご記入ください（任意）</div>
        <textarea id="allergyDetail" placeholder="例）ラテックス、金属アレルギー等"></textarea>
      </div>
    </div>

    <!-- 既往歴 -->
    <div class="field">
      <div class="label">既往歴 <span class="badge-required">必須</span></div>
      <div class="toggle" role="group" aria-label="既往歴">
        <button type="button" data-group="history" data-value="有">有</button>
        <button type="button" data-group="history" data-value="無">無</button>
      </div>
      <div id="historyDetailWrap" class="detail-wrap">
        <div class="label" style="margin-top:10px">有りの場合は詳細をご記入ください（任意）</div>
        <textarea id="historyDetail" placeholder="例）心臓疾患・皮膚疾患など"></textarea>
      </div>
    </div>

    <!-- お薬の服用 -->
    <div class="field">
      <div class="label">お薬の服用はありますか？ <span class="badge-required">必須</span></div>
      <div class="toggle" role="group" aria-label="服薬">
        <button type="button" data-group="medication" data-value="有">有</button>
        <button type="button" data-group="medication" data-value="無">無</button>
      </div>
      <div id="medDetailWrap" class="detail-wrap">
        <div class="label" style="margin-top:10px">有りの場合は詳細をご記入ください（任意）</div>
        <textarea id="medDetail" placeholder="例）薬品名・目的・服用頻度など"></textarea>
      </div>
    </div>

    <!-- 備考 -->
    <div class="field">
      <div class="label">備考</div>
      <textarea id="note" placeholder="ご要望や気になる点などがあればご記入ください"></textarea>
    </div>

    <button id="submitBtn" class="submit" type="button">送 信</button>
  </div>

  <!-- LIFF SDK -->
  <script src="https://static.line-scdn.net/liff/edge/2.1/sdk.js"></script>
  <script>
    // ====== UI Logic ======
    const state = {
      gender: '',
      visitedEsthe: '',
      allergy: '',
      history: '',
      medication: ''
    };

    function setActive(group, value, btn){
      document.querySelectorAll(`button[data-group="${group}"]`).forEach(b => b.classList.remove('active'));
      btn.classList.add('active');
      state[group] = value;
      // detail toggles
      if(group === 'allergy') toggleDetail('allergyDetailWrap', value === '有');
      if(group === 'history') toggleDetail('historyDetailWrap', value === '有');
      if(group === 'medication') toggleDetail('medDetailWrap', value === '有');
    }

    function toggleDetail(id, show){
      const el = document.getElementById(id);
      if(!el) return;
      el.classList.toggle('show', !!show);
      // クリア
      if(!show){
        const ta = el.querySelector('textarea');
        if(ta) ta.value = '';
      }
    }

    document.addEventListener('click', (e)=>{
      const t = e.target;
      if(t.matches('button[data-group]')){
        setActive(t.dataset.group, t.dataset.value, t);
      }
    });

    // ====== Validation ======
    function isValidPhone(v){
      const digits = (v||'').replace(/\D/g, '');
      return /^0\d{9,10}$/.test(digits); // 日本の携帯/固定（10-11桁）
    }

    function formatDateJP(iso){
      if(!iso) return '';
      const [y,m,d] = iso.split('-');
      return `${y}年${m}月${d}日`;
    }

    function alertAndFocus(msg, selector){
      alert(msg);
      const el = document.querySelector(selector);
      if(el) el.focus();
    }

    // ====== Submit ======
    document.getElementById('submitBtn').addEventListener('click', async () => {
      const name = document.getElementById('name').value.trim();
      const tel = document.getElementById('tel').value.trim();
      const address = document.getElementById('address').value.trim();
      const birth = document.getElementById('birth').value.trim();
      const allergyDetail = document.getElementById('allergyDetail').value.trim();
      const historyDetail = document.getElementById('historyDetail').value.trim();
      const medDetail = document.getElementById('medDetail').value.trim();
      const note = document.getElementById('note').value.trim();

      // 必須チェック
      if(!name) return alertAndFocus('お名前を入力してください。', '#name');
      if(!tel) return alertAndFocus('電話番号を入力してください。', '#tel');
      if(!isValidPhone(tel)) return alertAndFocus('電話番号はハイフンなしの10〜11桁で入力してください。', '#tel');
      if(!address) return alertAndFocus('住所を入力してください。', '#address');
      if(!birth) return alertAndFocus('生年月日を選択または入力してください。', '#birth');
      if(!state.gender) return alert('性別を選択してください。');
      if(!state.visitedEsthe) return alert('「過去にエステサロンに通ったことがあるか」を選択してください。');
      if(!state.allergy) return alert('アレルギーの有無を選択してください。');
      if(!state.history) return alert('既往歴の有無を選択してください。');
      if(!state.medication) return alert('お薬の服用の有無を選択してください。');

      const msg = [
        '≪アンケート≫',
        `【お名前】\n・${name}`,
        `【電話番号】\n・${tel}`,
        `【住所】\n・${address}`,
        `【生年月日】\n・${formatDateJP(birth)}`,
        `【性別】\n・${state.gender}`,
        `【過去にエステサロンに通ったことがありますか】\n・${state.visitedEsthe}`,
        `【アレルギーの有無】\n・${state.allergy}`,
        state.allergy === '有' && allergyDetail ? `【アレルギー詳細】\n・${allergyDetail}` : null,
        `【既往歴】\n・${state.history}`,
        state.history === '有' && historyDetail ? `【既往歴の詳細】\n・${historyDetail}` : null,
        `【お薬の服用】\n・${state.medication}`,
        state.medication === '有' && medDetail ? `【服用詳細】\n・${medDetail}` : null,
        note ? `【備考】\n・${note}` : null
      ].filter(Boolean).join('\n\n');

      try{
        await liff.init({ liffId: '2008421670-N2WjE6KL' }); // ★必要に応じて差し替え
        await liff.sendMessages([{ type:'text', text: msg }]);
        alert('ご記入ありがとうございます。送信が完了しました。');
        liff.closeWindow();
      }catch(err){
        console.error('送信エラー:', err);
        alert('送信時にエラーが発生しました。電波状況をご確認の上、時間をおいて再度お試しください。');
      }
    });
  </script>
</body>
</html>
